var version=function(e,a,n,t,i,l,r,d,s){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var g=o(a),u=o(n),c=o(s);const m={instanceVariable:"\n    {\n      instanceVariable(filter: {id: $id}) {\n        id\n        name {\n          languageCode\n          languageText\n        }\n        reverseLineageFieldInstanceVariable {\n          id\n          smart {\n            id\n            lineageDataset {\n              id\n              reverseUnitDataSetLineage {\n                id\n                name {\n                  languageCode\n                  languageText\n                }\n                description {\n                  languageCode\n                  languageText\n                }\n                version\n                administrativeStatus\n                valuation\n                createdBy\n                lastUpdatedBy\n                metadataSourcePath\n                shortName\n                temporalityType\n                dataSetState\n                dataSourcePath\n              }\n            }\n          }\n        }\n      }\n    }\n  ",representedVariable:"\n    {\n      representedVariable(filter: {id: $id}) {\n        id\n        name {\n          languageCode\n          languageText\n        }\n        reverseInstanceVariableRepresentedVariable {\n          id\n          name {\n            languageText\n            languageCode\n          }\n          reverseLineageFieldInstanceVariable {\n            id\n            smart {\n              id\n              lineageDataset {\n                id\n                reverseUnitDataSetLineage {\n                  id\n                  name {\n                    languageText\n                    languageCode\n                  }\n                  description {\n                    languageText\n                    languageCode\n                  }\n                  version\n                  administrativeStatus\n                  valuation\n                  createdBy\n                  lastUpdatedBy\n                  metadataSourcePath\n                  shortName\n                  temporalityType\n                  dataSetState\n                  dataSourcePath\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  ",variable:"\n    {\n      variable(filter: {id: $id}) {\n        id\n        name {\n          languageCode\n          languageText\n        }\n        reverseRepresentedVariableVariable {\n          id\n          name {\n            languageText\n            languageCode\n          }\n          reverseInstanceVariableRepresentedVariable {\n            id\n            name {\n              languageText\n              languageCode\n            }\n            reverseLineageFieldInstanceVariable {\n              id\n              smart {\n                id\n                lineageDataset {\n                  id\n                  reverseUnitDataSetLineage {\n                    id\n                    name {\n                      languageText\n                      languageCode\n                    }\n                    description {\n                      languageText\n                      languageCode\n                    }\n                    version\n                    administrativeStatus\n                    valuation\n                    createdBy\n                    lastUpdatedBy\n                    metadataSourcePath\n                    shortName\n                    temporalityType\n                    dataSetState\n                    dataSourcePath\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  "},h="/health/ready",b="instanceVariable",f="representedVariable",p="variable",E="name",S={DATASET_TYPES:["unitDataSet"],VARIABLE_TYPES:["instanceVariable","representedVariable","variable"],SMART:["smart"],UNIT_DATA_SET:["lineageDataset","reverseUnitDataSetLineage"]},v={LF_IV:"reverseLineageFieldInstanceVariable",IV_RV:"reverseInstanceVariableRepresentedVariable",RV_V:"reverseRepresentedVariableVariable",UDS_L:"reverseUnitDataSetLineage"},V=new c.default({lightness:[.35,.5,.65]}),T={dataset:"square",instanceVariable:"circle",representedVariable:"diamond",variable:"star"},y=(e,a,n,t)=>a.reduce(((a,l)=>{const r={nodes:[],links:[]},d=(e,a)=>{0!==e.length&&e.forEach((e=>{const n=i.getNestedObject(e,S.SMART);void 0!==n&&0!==n.length&&n.forEach((e=>{const n=i.getNestedObject(e,S.UNIT_DATA_SET);void 0!==n&&0!==n.length&&n.forEach((e=>{r.nodes.push({id:e.id,nodeLabelName:i.getLocalizedGsimObjectText(t,e[E]),color:V.hex(e.id),symbolType:T.dataset}),r.links.push({source:a,target:e.id})}))}))}))},s=(e,a)=>{0!==e.length&&e.forEach((e=>{r.nodes.push({id:e.id,nodeLabelName:i.getLocalizedGsimObjectText(t,e[E]),color:V.hex(e.id),symbolType:T.instanceVariable}),r.links.push({source:a,target:e.id}),d(e[v.LF_IV],e.id)}))};switch(n){case b:const a=l[n][v.LF_IV];d(a,e);break;case f:const o=l[n][v.IV_RV];s(o,e);break;case p:((e,a)=>{0!==e.length&&e.forEach((e=>{r.nodes.push({id:e.id,nodeLabelName:i.getLocalizedGsimObjectText(t,e[E]),color:V.hex(e.id),symbolType:T.representedVariable}),r.links.push({source:a,target:e.id}),s(e[v.IV_RV],e.id)}))})(l[n][v.RV_V],e)}return r}),{}),L={API_ERROR_MESSAGE:{en:"Something went wrong, check settings",nb:"Noe gikk galt, sjekk innstillingene"},HEADER:{en:"Lineage Viewer",nb:"Sporingsvisning"},LEGEND:["instanceVariable","","representedVariable","dataset","variable"]},R=new c.default({lightness:[.35,.5,.65]});function C({language:e,variableId:n,variableType:s}){const[o,u]=a.useState(!1),[c,h]=a.useState(""),[b]=a.useState({nodeHighlightBehavior:!0,automaticRearrangeAfterDropNode:!1,staticGraph:!1,node:{labelProperty:e=>""===e.nodeLabelName||"-"===e.nodeLabelName?e.id:e.nodeLabelName,size:300,highlightStrokeColor:"blue",fontSize:14,highlightFontSize:14,highlightFontWeight:"bold"},link:{highlightColor:"lightblue"},d3:{gravity:-1500,linkLength:200},width:(.75*window.screen.width*.96).toFixed(0),height:600});const[f,{loading:p,error:S,data:v}]=l.useManualQuery((e=>m[e])(s),{variables:{id:n}});a.useEffect((()=>{f().then((()=>null))}),[f]),a.useEffect((()=>{if(!p&&!S&&void 0!==v){const a=y(n,v,s,e),t={nodes:a.nodes.concat([{id:n,nodeLabelName:i.getLocalizedGsimObjectText(e,v[0][s][E]),color:R.hex(n),size:600,fontSize:20,highlightFontSize:20,symbolType:T[s]}]).filter(((e,a,n)=>n.findIndex((a=>a.id===e.id))===a)),links:a.links};u(t)}}),[p,S,v,n,s,e]);return g.default.createElement(g.default.Fragment,null,g.default.createElement(t.Header,{content:"Sporing av "+n}),o&&g.default.createElement(t.Grid,null,g.default.createElement(t.Grid.Column,{width:12},g.default.createElement(t.Segment,{raised:!0},g.default.createElement(r.Graph,{id:"graph-id",data:o,config:b,onClickNode:e=>h(e)}),g.default.createElement(t.Rail,{attached:!0,internal:!0,position:"right"},g.default.createElement(t.Segment,null,g.default.createElement(t.Grid,null,[4,2,0,3].map((e=>g.default.createElement(t.Grid.Row,{style:{paddingTop:"0.5rem",paddingBottom:"0.5rem"}},g.default.createElement(t.Grid.Column,{width:2},g.default.createElement("svg",{width:"30",height:"30",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},g.default.createElement("path",{transform:"translate(15, 15)",style:{fill:i.SSB_COLORS.GREY},d:d.symbol(d.symbols[e],300)()}))),g.default.createElement(t.Grid.Column,{width:14,verticalAlign:"middle"},"= "+L.LEGEND[e]))))))))),g.default.createElement(t.Grid.Column,{width:4},g.default.createElement(t.Segment,{raised:!0},"Clicked node: "+c))))}return e.LineageViewer=function({restApi:e,language:n}){const[l,r]=a.useState(!1),[d,s]=a.useState("Variable_DUMMY"),[o,c]=a.useState(S.VARIABLE_TYPES[2]),[{loading:m,error:b}]=u.default(`${e}${h}`,{useCache:!1});return a.useEffect((()=>{if(m||b)r(!1);else{r(!0);const e=window.location.search,a=new URLSearchParams(e),n=a.get("id"),t=a.get("type");s(n),c(t)}}),[b,m]),g.default.createElement(g.default.Fragment,null,g.default.createElement(t.Grid,null,g.default.createElement(t.Grid.Column,{width:3},g.default.createElement(t.Input,{fluid:!0,value:d,onFocus:e=>e.target.select(),onKeyPress:({key:e})=>"Enter"===e&&r(!0),onChange:(e,{value:a})=>{r(!1),s(a)}})),g.default.createElement(t.Grid.Column,{width:13},g.default.createElement(t.Dropdown,{selection:!0,value:o,options:S.VARIABLE_TYPES.map((e=>({key:e,text:e,value:e}))),onChange:(e,{value:a})=>{r(!1),c(a)}}))),g.default.createElement(t.Divider,{hidden:!0}),g.default.createElement(t.Button,{primary:!0,content:"Go",onClick:()=>r(!0)}),m?g.default.createElement(t.Loader,{active:!0,inline:"centered"}):b?g.default.createElement(i.ErrorMessage,{error:L.API_ERROR_MESSAGE[n],language:n}):l&&g.default.createElement(C,{language:n,variableId:d,variableType:o}))},Object.defineProperty(e,"__esModule",{value:!0}),e}({},React,useAxios,semanticUiReact,daplaJsUtilities,graphqlHooks,reactD3Graph,d3Shape,ColorHash);
